---
title: 'Handling imbalanced data with resampling'
excerpt: "It's not uncommon for data scientists to work on imabalnced data, i.e. such data where classes are not uniformly distributed and one or two classes present a vast majority. Actually, most of classification data is usually imbalanced. To name but a few: medical data to diagnose a condition, fraud detection data, churn client data etc."
permalink: /posts/imbalanced-ml/

---

<div style="text-align: justify;">It's not uncommon for data scientists to work on imabalnced data, i.e. such data where classes are not uniformly distributed and one or two classes present a vast majority. Actually, most of classification data is usually imbalanced. To name but a few: medical data to diagnose a condition, fraud detection data, churn client data etc.</div>
<p>
<div style="text-align: justify;">The problem here is that machine learning algorithms may overfit on the majority class and totally ignore the minor classes. At the same time, it is the minority class samples (a rare disease or a fraudulent transaction) that we are interested in detecting! One of the ways to overcome the problem of imbalanced data is resampling, i.e. changing the number of samples in the different classes. There are at least three ways to resample data:</div>
<p>

<ul>  
  <li>Oversampling: adding the minory class samples.</li>
  <li>Undersampling: deleting the majority class samples.</li>
  <li>Combination of oversampling and udnersampling.</li>
</ul>

<div style="text-align: justify;">In this notebook we will examine some popular resampling techniques as well as discover why Accuracy is not always a good evaluation metric.</div>

<div style="text-align: justify;">First, we will look at different resampling methods in action and plot the results. Afterwards we are going to create a classification model on imbalanced data with and without resampling.</div>

<h2>Resampling on synthetic data</h2>
<h3>Generate imbalanced data</h3>
<div style="text-align: justify;">Let's create some imbalanced data to demonstrate the differene between resampling methods.</div>
<p>
<script src="https://gist.github.com/maya-ami/66f9bb3c1afa7c27fda563d3a251ddc0.js"></script>
<p>
<img src="/images/im_data.png">
<p>

<h3>Random oversampling</h3>
<div style="text-align: justify;">First, let's try the most naive approach - random oversampling. This will create a duplicate samples of a minor class.</div>
<p>
  <script src="https://gist.github.com/maya-ami/4eb0c5793431ae1379c8e19e27561ca6.js"></script>
<p>
  <img src="/images/ros.png">
<p>

<h3>SMOTE</h3>
<div style="text-align: justify;">A more advanced method - SMOTE (Synthetic Minority Oversampling Technique) - doesn't just duplicate an existing sample. SMOTE generates a new sample considering its k neareast-neighbors.</div>
<p>
  <script src="https://gist.github.com/maya-ami/395107e16863e0881a11814163fc55f5.js"></script>
<p>
  <img src="/images/smote.png">

<div style="text-align: justify;">The plot shows that SMOTE generates many "noisy" samples that are placed between the outliers and the true minor samples.</div>
<p>


<h3>SMOTEEN</h3>
<div style="text-align: justify;">To solve this problem, one may use any of "cleaning" undersampling methods. For instance, SMOTEEN (SMOTE + Edited Nearest Neighbours) generates new samples as a vanila SMOTE, but then deletes those which class is different from the k-nearest neighbours' class.</div>
<p>
  <script src="https://gist.github.com/maya-ami/a7daa304ad814b36510ad272117d7214.js"></script>
<p>
  <img src="/images/smoteenn.png">


<h3>Random undersampling</h3>
<div style="text-align: justify;">The plot below shows how random undersampling, i.e. random deletion of major class samples, work.</div>
<p>
  <script src="https://gist.github.com/maya-ami/b6a686b862e229a8836fae30f9e133c9.js"></script>
<p>
  <img src="/images/rus.png">


<h3>Near Miss</h3>
<div style="text-align: justify;">Another undersampling method - Near Miss - deletes the major class samples for which the average distance to the N closest samples of the minor class is the smallest.</div>
<p>
  <script src="https://gist.github.com/maya-ami/677abf8d3d7b6cf06e4b07d623c99168.js"></script>
<p>
  <img src="/images/miss.png">



<!-- <h2>Resampling on real data</h2>

<div style="text-align: justify;">Now that we have a basic idea how different resampling approaches work, let's try to apply this knowledge in a real classification task. We are provided with the information about the results of a bank marketing campaign. Our task is to predict whether the client signs a term deposit.</div> -->


<div style="text-align: justify;"></div>


<div style="text-align: justify;"></div>
<div style="text-align: justify;"></div>
<div style="text-align: justify;"></div>
